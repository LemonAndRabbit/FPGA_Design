# FPGA_Design
> by Ye Zhifan

## 简介：

本FPGA设计改编自经典游戏《是男人就下一百层》，在游戏中，通过按键控制人物左右移动，在不同的横板之间跳跃。横板是水平方向的一系列板，每一块横板都会以恒定的速度向上移动，当一块横板移到屏幕最上方而消失时，又会有新的板从屏幕最下方随机位置出现。游戏的目标时通过控制主人公的左右移动,从而防止人物掉落到屏幕最下方或者被某一块上移的平板顶到屏幕最上方。

## 实验环境：

> [Diligent Nexys4 FPGA](https://reference.digilentinc.com/reference/programmable-logic/nexys-4-ddr/start) 
>
> Vivado 2019.1 for Windows
>
> 外设：
>
> PS/2 Keyboard
>
> VGA Display Device

## 特点： 

> [一个演示视频](video.mp4)
>
> 开始时，演示了游戏死亡画面（全屏变红），然后演示了正常游玩画面（通过键盘控制输入，并未拍摄键盘），然后LED灯显示了游戏得分，游戏末尾展示了一个小彩蛋（画面倒置，通过得到一定分数触发）

1. PS/2键盘输入；  
2. VGA 显示：包括人物，横板，心形三种物体和背景的显示。并设定了各个物体显示的优先级<仅当无需显示更高优先级的图形时，才会显示下一优先级的图形>，同时采用了蓝幕技术<每个图形（可能为不规则图形）均存储为矩形的像素文件，用特定颜色表示某一像素其实可能不属于特定图形，这时就显示下一优先级的图形>；    
3. 游戏系统：键盘控制下的人物移动与跳跃，计算剩余生命值，横板位置的随机生成；

## 文件列表：

| 位置                  | 内容                                                         |
| --------------------- | ------------------------------------------------------------ |
| srcs/                 | 源码                                                         |
| srcs/ip/              | 一系列 coe 文件，通过处理原始图片得到                        |
| srcs/new/             | 模块源码                                                     |
| srcs/new/top.v        | 顶层模块，实现了游戏逻辑，计算画面输出                       |
| srcs/new/counter.v    | 计数器模块，用于生成特定时钟信号                             |
| srcs/new/keyboard.v   | 键盘模块，通过一个有限状态自动机读取PS/2接口的键盘输入，判断通码断码 |
| srcs/new/vga.v        | VGA模块，控制VGA输出的行同步信号和列同步信号，提示top模块当前应该输出的像素所在的行和列 |
| srcs/new/seg7.v       | 控制7段数码管输出                                            |
| srcs/new/background.v | 根据要显示的位置提取背景中的像素，其他图像像素的提取工作在 top.v 中完成 |
| imgs/                 | 一系列原始图像文件，通过该文件夹下的matlab文件提取像素       |
| Nexys.xdc             | 约束文件                                                     |
| vedio.mp4             | 演示视频                                                     |
